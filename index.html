<!DOCTYPE html>
<html>
<head>
<title>Cast Videos: Google Cast Chrome Sender SDK Demo App</title>
<script src="./newrelic-caf.min.js"></script>
<script src="./agent.js"></script>
<link rel="icon" type="image/x-icon" href="imagefiles/favicon.ico" />
<link rel="icon" type="image/png" href="imagefiles/favicon_16x16.png" />
<link rel="icon" type="image/png" href="imagefiles/favicon_32x32.png" />
<link rel="icon" type="image/png" href="imagefiles/favicon_64x64.png" />
<link rel="stylesheet" type="text/css" href="css/CastVideos.css">
<link href='//fonts.googleapis.com/css?family=Roboto&subset=latin,cyrillic-ext,greek-ext,latin-ext' rel='stylesheet' type='text/css'>
</head>
<body>
      <div id="top_header">
        <div id="logo"></div>
      </div>
      <div id="main_video">
        <div class="imageSub"> <!-- Put Your Image Width -->
           <div class="blackbg" id="playerstatebg">IDLE</div>
           <div class=label id="playerstate">IDLE</div>
           <img src="images/bunny.jpg" id="video_image">
           <div id="video_image_overlay"></div>
           <video id="video_element">
           </video>
        </div>

        <div id="media_control">
           <div id="play"></div>
           <div id="pause"></div>
           <div id="progress_bg"></div>
           <div id="progress"></div>
           <div id="progress_indicator"></div>
           <div id="fullscreen_expand"></div>
           <div id="fullscreen_collapse"></div>
           <div id="audio_bg"></div>
           <div id="audio_bg_track"></div>
           <div id="audio_indicator"></div>
           <div id="audio_bg_level"></div>
           <div id="audio_on"></div>
           <div id="audio_off"></div>
           <div id="duration">00:00:00</div>
        </div>
      </div>
      <div id="media_info">
        <div id="media_title">
        </div>
        <div id="media_subtitle">
        </div>
        <div id="media_desc">
        </div>
      </div>

      <div id="carousel">
      </div>

      <div id="footer">
        <div id="copyright">Copyright 2019 Google LLC. All Rights reserved</div>
        <div id="footer_content">Visit the <a id="footer_content_link" href="https://developers.google.com/cast/">Google Cast Developer Site</a></div>
        <div id="footer_language">Language English</div>
      </div>

      <script src="CastVideos.js"></script>
      <script type="text/javascript">
        var castPlayer = new CastPlayer();
          // Initialize New Relic Video Tracker
  const videoElement = document.getElementsByTagName('cast-media-player')[0];
  const newRelicTracker = new NewRelicVideoTracker({
      licenseKey: 'NRBR-940177a1ae3f2107673',
      applicationID: '601520543',
      videoElement: videoElement // Make sure this references the correct element
  });
  console.log('New Relic Tracker initialized');

  // Initialize Cast Application Framework
  const context = cast.framework.CastReceiverContext.getInstance();
  const playerManager = context.getPlayerManager();

  playerManager.addEventListener(cast.framework.events.EventType.PLAYER_LOAD_COMPLETE, () => {
      newRelicTracker.trackLoad();
      console.log('PLAYER_LOAD_COMPLETE event tracked');
  });

  playerManager.addEventListener(cast.framework.events.EventType.PLAY, () => {
      newRelicTracker.trackPlay();
      console.log('PLAY event tracked');
  });

  playerManager.addEventListener(cast.framework.events.EventType.PAUSE, () => {
      newRelicTracker.trackPause();
      console.log('PAUSE event tracked');
  });

  playerManager.addEventListener(cast.framework.events.EventType.ENDED, () => {
      newRelicTracker.trackEnd();
      console.log('ENDED event tracked');
  });

  playerManager.addEventListener(cast.framework.events.EventType.ERROR, (event) => {
      newRelicTracker.trackError(event);
      console.error('ERROR event tracked', event);
  });

  // Start the Cast Receiver
  context.start();

  // Set logging level (show all messages)
  cast.framework.CastReceiverContext.getInstance().setLoggerLevel(cast.framework.LoggerLevel.DEBUG);

  // Capture JS errors
  window.onerror = function (msg, url, line) {
      console.log("Message: " + msg);
      console.log("URL: " + url);
      console.log("Line number: " + line);
      newrelic.addPageAction("JSError", {"errMessage": msg, "errUrl": url, "errLine": line})
  }
      </script>
          <script src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js"></script>
          <script src="sender.js"></script>
</body>
</html>